<!DOCTYPE html>
<html>
<head>
<title>Weather_Map</title>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">

<link rel="stylesheet" href="/css/weather_map.css">

<style type="text/css">
    #map-canvas {
        width: 100%;
        height: 400px;
    }
</style>
</head>
<body>
<div class="container">
    <div id="map-canvas"></div>
    <input id="userSearch" type="text" placeholder="Enter location">  
    <button id="searchButton" class="btn-default">Search</button>

    <div class="row">
        <div id="placeName" class="day col-md-5"></div>

        <div id="today" class="day col-md-2"></div>

        <div id="tomorrow" class="day col-md-2"></div>

        <div id="dayAfterTomorrow" class="day col-md-3"></div>
    </div>
    <div class="row">
    <!-- search box -->
     
    <div class="col-sm-12">
            <form class="form-inline"> 
                <input class="form-control" id="latitude" placeholder="Latitude">
                <input class="form-control" id="longitude" placeholder="Longitude">
                <button class="btn-default" id="latLngButton">Get weather</button>
            </form>
        </div>
    </div>
</div>
<!-- load ajax -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>

<!-- Load the Google Maps API -->
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCD1RjuhbrRWrs837HiSa6A2ULBUg2J96c"></script>
<script>
"use strict";

function loadMap(latitude, longitude){
//load map
    var mapOptions = {
        zoom: 5,
        center: {
            lat: latitude,
            lng: longitude
        }
    };

    var map = new google.maps.Map(document.getElementById("map-canvas"), mapOptions);

    var marker = new google.maps.Marker({
        position: {
            lat: latitude,
            lng: longitude
        },
        draggable:true,
        map: map
    });

    // marker drag
    marker.addListener("dragend", function(){
        var markerPosition = marker.getPosition();
        loadWeather(markerPosition.lat, markerPosition.lng);
    });
    // marker on click
google.maps.event.addListener(map, 'click', function(event) {
    placeMarker(event.latLng);

})
    function placeMarker(location) {
        marker.setPosition(location);
        map.setCenter(location);
        var markerPosition = marker.getPosition();
        loadWeather(markerPosition.lat, markerPosition.lng);

}
}
// load weather

function loadWeather(latitude, longitude){

    $.get("http://api.openweathermap.org/data/2.5/forecast/daily", {
        APPID: "64d8990e4fdb37b42608f9844ad7a373",
        lat:    latitude,
        lon:    longitude,
        units: "metric"
    }).done(function(data){

        $('#placeName').html('<h2>' + data.city.name + ' ' + data.city.country);

        $('#today').html('<strong>Today</strong><img src="http://openweathermap.org/img/w/' + data.list[0].weather[0].icon + '.png"><p>' + data.list[0].temp.max + ' °C</p><p>' + data.list[0].weather[0].description);

        $('#tomorrow').html('<strong>Tomorrow</strong><img src="http://openweathermap.org/img/w/' + data.list[1].weather[0].icon + '.png"><p>' + data.list[1].temp.max + ' °C</p><p>' + data.list[1].weather[0].description);

        $('#dayAfterTomorrow').html('<strong>Day after tomorrow</strong><img src="http://openweathermap.org/img/w/' + data.list[2].weather[0].icon + '.png"><p>' + data.list[2].temp.max + ' °C</p><p>' + data.list[2].weather[0].description);
    });
}
//search button click

$('#searchButton').click( function(event){
    var geocoder = new google.maps.Geocoder();

    geocoder.geocode({ "address": $('#userSearch').val() }, function(results, status) {
    console.log(results)

    var latitude = results[0].geometry.location.lat();
    var longitude = results[0].geometry.location.lng();

    loadMap(latitude, longitude);
    loadWeather(latitude, longitude);
    });
});

//lat lng button click

$('#latLngButton').click( function(event){
    event.preventDefault();
    var latitude = parseFloat($('#latitude').val());
    var longitude = parseFloat($('#longitude').val());
    loadMap(latitude, longitude);
    loadWeather(latitude, longitude);
});

loadMap(29.423017, -98.48527);
loadWeather(29.423017, -98.48527);

</script>
</body>